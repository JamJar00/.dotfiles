import tea
import tea/beta/brew
import tea/beta/pipx

import files/bashrc.tea
import files/config.fish.tea
import files/gitconfig.tea
import files/nvim.tea
import files/vimrc.tea

import tools/aws.tea
import tools/docker.tea
import tools/fish.tea
import tools/neovim.tea
import tools/prompt.tea
import tools/tree-sitter.tea
import tools/rust-analyzer.tea
import tools/spotify.tea

set shell sh

define type group
  for timestamp do { echo 2147483647 } # This only works when dealing with booleans. When files have timestamps this will hide changes from things above
end

define type dotnet_tool
  for timestamp do {
    dotnet tool list --global | grep -q "$TEA_FOR" && echo 0
  }
end

# TODO write node install script

dotnet_tool (*)
  depends on tea:command dotnet
  do {
    dotnet tool install --global "$TEA_FOR"
  }
end

group csharp
  depends on dotnet_tool csharp-ls
  do {}
end

group kubernetes
  depends on [
    tea:brew:package helm,
    tea:brew:package kubectx,
    tea:brew:package kubernetes-cli
  ]
  do {}
end

group python
  depends on [
    tea:pipx:package poetry,
    tea:pipx:package pyright
  ]
  do {}
end

group terraform
  depends on [
    tea:brew:package terraform-ls,
    tea:brew:package tflint,
    tea:brew:package tfsec
  ]
  do {}
end

group base
  depends on [
    file "~/.bashrc",
    file "~/.config/fish/config.fish",
    file "~/.config/nvim",
    file "~/.gitconfig",
    file "~/.vimrc",

    tea:command fish,
    tea:command nvim,
    tea:command node,
    tea:command prompt,
    tea:command tree-sitter,

    tea:command spotify,

    group python
  ]
  do {}
end

task install
  depends on [
    tea:platform:hostname FXJXWHJ0W0.local,

    group base,

    group csharp,
    group kubernetes,
    group terraform,

    tea:command rust-analyzer,
    tea:brew:package minikube,
    tea:brew:package shellcheck,
    tea:brew:cask openvpn-connect,
    tea:brew:cask pritunl
  ]
  do {}
end

task install
  depends on [
    tea:platform:hostname FEATHERS,

    group base,

    tea:command rust-analyzer
  ]

    # tea:scoop:package 7zip,
    # tea:scoop:package coretemp,
    # tea:scoop:package cpuz,
    # tea:scoop:package screentogif,
    # tea:scoop:package rclone,
    # tea:scoop:package yt-dlp
    # tea:scoop:package win32yank
    # tea:scoop:package CascadiaCode-NF-Mono
  do {}
end

task install
  depends on [
    tea:platform:hostname FLUFFLES,
    tea:platform:os Windows,
  ]
    # tea:scoop:package 7zip,
    # tea:scoop:package coretemp,
    # tea:scoop:package cpuz,
    # tea:scoop:package screentogif,
    # tea:scoop:package rclone,
    # tea:scoop:package yt-dlp
    # tea:scoop:package win32yank
    # tea:scoop:package CascadiaCode-NF-Mono
  do {}
end

task install
  depends on [
    tea:platform:hostname FLUFFLES,
    tea:platform:os "GNU/Linux",

    group base,

    tea:command aws,
    tea:command docker,
    tea:command rust-analyzer,
    tea:pipx:package pyright
  ]
  do {}
end

task install-wacom-tablet-drivers
  depends on [
    tea:brew:cask wacom-tablet
  ]

  do {}
end

# Override for some scoop installs so that they depend on the right bucket
# tea:scoop:package win32yank
#   depends on tea:scoop:bucket extras
#   do {
#     scoop install win32yank
#   }
# end
#
# tea:scoop:package CascadiaCode-NF-Mono
#   depends on tea:scoop:bucket nerd-fonts
#   do {
#     scoop install CascadiaCode-NF-Mono
#   }
# end
